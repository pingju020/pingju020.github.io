SCP_IOS API 简介第一组 初始化接口/**功能：初始化非网络信息。(加载库时，调用一次即可。)参数：无。返回值：true表示成功；false表示失败。*/bool scp_initNonNetworkInfo();/**功能：初始化网络信息。(加载库时，调用一次。当网络状态变化时，需调用此方法。)参数：localIp：本地ip地址(ipv4)。destIp：端站ip地址(ipv4)。localPort：本地端口。destPort：端站端口。返回值：true表示成功；false表示失败。*/bool scp_initNetworkInfo(const char* localIp, const char* destIp, int localPort, int destPort);/**功能：初始化设备的IMEI。(加载库时，调用一次。注意：不是设备的IMEI，而是由调用者自己产生，并确保唯一。)参数：15位的字符串IMEI。返回值：无。*/void setImei(const std::string _imei);/**功能：设置本地支持的所有媒体格式及其附属信息。(加载库时，调用一次。)参数：Example: int numericalPayloads[2] = {18, 104};std::string strPayloads[2] = {“”, “iLBC/8000”};std::string strPayloadsParam[2] = {“”, “30”};scp_setPayloads(numericalPayloads, strPayloads, strPayloadsParam, 2);返回值：true表示成功；false表示失败。*/bool scp_setPayloads(int* numericalPayloads, const std::string* strPayloads, const std::string* strPayloadsParam, int size);第二组 注册(包括注销)业务接口/**功能：注册接口。参数：reg： 用户名。pwd： 密码。返回值：注册会话ID。(范围：0 ~ 31)。失败则返回-1。*/long Register(const char* reg, const char* pwd);/**功能：注销接口。参数：reason：注销原因码。sessionId：会话ID(即登录成功时保存的ID)。返回值：true表示执行了注销操作。(从应用角度看，没有注销失败的场景。)*/bool unregister(int reason, long sessionId);/**功能：获取当前注册状态。参数：无。返回值：typedef enum {	Default_Register_State = -1,	Offline = 0,    //离线	Registering,    //注册中...	Online,        //在线	UnRegistering  //注销中...} REGISTER_STATE;*/int getRegisterState();/**功能：设置注册消息回调接口。当SCP收到注册/注销响应，或超时，调用此接口。参数：回调方法指针。(参数格式： typedef void alis_scpCallback_OnRegisterEvent(long sessionId, int msgType, int reason, int code); 其中msgType、reason、code的说明见附录)返回值：无。*/void set_scpCallback_OnRegisterEvent(alis_scpCallback_OnRegisterEvent *);第三组 起呼/寻呼业务接口/**功能：创建并返回起呼会话ID。(起呼时最先调用。)参数：无。返回值：起呼会话ID。(范围：0 ~ 31)。失败则返回-1。*/long createInviteSession();/**功能：发起起呼。参数：sessionId：起呼会话ID。(即createInviteSession()的返回值。)number：对方号码。roaming：远洋近海标志。返回值：true表示执行了起呼操作；false表示执行起呼操作失败。*/bool invite(long sessionId, const char* number, int roaming);/**功能：获取语音状态。参数：语音会话ID。返回值：typedef enum {	Default_Invite_State = -1,	State_Invite_Idle = 0,     //创建session时的默认值	State_Invite_Setup,       //建链态	State_Invite_Ringing,     //早期媒体态	State_Invite_InCall,       //通话态	State_Invite_Release      //释放态} INVITE_STATE;*/int getInviteState(long sessionId);/**功能：接听来电。参数：sessionId：语音会话ID。roaming：远洋近海标志。返回值：true表示执行了接听操作；false表示执行接听操作失败。*/bool Accept(long sessionId, int roaming);/**功能：释放语音会话。参数：sessionId：语音会话ID。reason：释放原因码。(见附录)返回值：true表示执行了释放操作；false表示执行释放操作失败。*/bool finishCall(long sessionId, int reason);/**功能：获取早期媒体信息。参数：语音会话ID。返回值：媒体信息对象指针。(见附录)*/MediaInfo* getEarlyMediaInfo(long sessionId);/**功能：获取语音媒体信息。参数：语音会话ID。返回值：媒体信息对象指针。*/MediaInfo* getIncallMediaInfo(long sessionId);/**功能：设置本地媒体信息。参数：sessionId：语音会话ID。mediaInfo：媒体信息对象指针。返回值：true表示执行了设置本地媒体信息操作；false表示执行设置本地媒体信息操作失败。*/bool setLocalMediaInfo(long sessionId, MediaInfo* mediaInfo);/**功能：设置语音消息回调接口。当起呼或者寻呼且状态变化时，将调用此接口。参数：回调方法指针。(参数格式： typedef void alis_scpCallback_OnInviteEvent(long sessionId, int msgType, int reason, int code, const char* desc); 其中msgType、reason、code的说明见附录)返回值：无。*/void set_scpCallback_OnInviteEvent(alis_scpCallback_OnInviteEvent *);第四组 RTP查询回调接口/**功能：设置周期为分钟的rtp发送报文数查询回调接口。参数：回调方法指针。(参数格式：typedef int alis_scpCallback_OnMinRtpSndNum();)返回值：无。*/void set_scpCallback_OnMinRtpSndNum(alis_scpCallback_OnMinRtpSndNum *);/**功能：设置周期为分钟的rtp接收报文数查询回调接口。参数：回调方法指针。(参数格式：typedef int alis_scpCallback_OnMinRtpRcvNum();)返回值：无。*/void set_scpCallback_OnMinRtpRcvNum(alis_scpCallback_OnMinRtpRcvNum *);/**功能：设置rtp发送报文数查询回调接口。参数：回调方法指针。(参数格式：typedef int alis_scpCallback_OnCallRtpSndNum();)返回值：无。*/void set_scpCallback_OnCallRtpSndNum(alis_scpCallback_OnCallRtpSndNum *);/**功能：设置rtp接收报文数查询回调接口。参数：回调方法指针。(参数格式：typedef int alis_scpCallback_OnCallRtpRcvNum();)返回值：无。*/void set_scpCallback_OnCallRtpRcvNum(alis_scpCallback_OnCallRtpRcvNum *);第四组 短信发送/接收业务接口/**功能：发送短信。参数：dbId：数据库ID。peerUri: 收件人号码。content：短信内容。返回值：短信会话ID。(范围：0 ~ 31)。失败则返回-1。*/long sendSms(long dbId, const char* peerUri, const char* content);/**功能：设置短信消息回调接口。当发送短信状态变化时，将调用此接口。参数：回调方法指针。(参数格式：typedef void alis_scpCallback_OnSmsEvent(long dbId, long sessionId, int msgType, int reason, const char* code); 其中msgType、reason、code的说明见附录)返回值：无。*/void set_scpCallback_OnSmsEvent(alis_scpCallback_OnSmsEvent *);第六组 网络刷新回调接口/**功能：设置网络回调接口。当SCP发现网络不正常时(如心跳失败)，将调用此接口更新网络。参数：回调方法指针。(参数格式： typedef void alis_scpCallback_OnInitScp();)返回值：无。*/void set_scpCallback_OnInitScp(alis_scpCallback_OnInitScp *);第五组 日志收集回调接口/**功能：设置日志回调接口。当SCP有写日志操作时，将调用此接口。参数：回调方法指针。(参数格式：typedef void alis_scpCallback_OnWriteLog(const char* info);)返回值：无。*/void set_scpCallback_OnWriteLog(alis_scpCallback_OnWriteLog *);第六组 端站状态查询接口/**功能：端站状态查询。参数：isSignalQry 默认填true，表示查询信号强度、远洋近海、是否是卫星wifi；填false时，还上报了rtp报文数。返回值：无。*/void scp_querySignalInfo(bool isSignalQry);/**功能：设置查询端站信息回调接口。当查询结果返回时，将调用此接口。参数：回调方法指针。(参数格式：typedef void alis_scpCallback_OnQueryMsg(const unsigned char resultInfo[], int len); 其中resultInfo、len的含义定义在协议文档中，见附录)返回值：无。*/void set_scpCallback_OnQueryMsg(alis_scpCallback_OnQueryMsg *);第七组 SCP健康检查接口/**功能：检查SCP的关键线程。参数：无。返回值：true表示运行正常，false表示运行异常。*/bool scp_threadHealthCheck();附录SCP消息及原因码的定义 MediaInfo类的定义class MediaInfo {public:		MediaInfo();	int getPort();    uchar getPayloadNum();	uchar* getPayloadTypes();    std::string getIp();    std::string* getPayloadParams();	void setPort(int);	void setIp(const std::string& ip);	void setPayloadTypes(uchar payloadNum, uchar payloadTypes[]);    void setPayloadTypes(uchar payloadNum, uchar payloadTypes[], std::string payloadParams[]);    void setParams(uchar payloadNum, std::string payloadParams[]);private:	int mPort;    uchar mPayloadNum;	uchar mPayloadTypes[MAX_PAYLOAD_NUM];    std::string mIp;    std::string mParams[MAX_PAYLOAD_NUM];};说明：#define MAX_PAYLOAD_TYPE_NUM  8      //负载类型值<=96，例如G729为18#define MAX_PAYLOAD_DESC_NUM  4      //负载类型值>=97，例如iLBC为104#define MAX_PAYLOAD_NUM (MAX_PAYLOAD_TYPE_NUM + MAX_PAYLOAD_DESC_NUM)